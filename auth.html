<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Регистрация/Вход | ЯжНаДэп</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --primary: #6d28d9;
            --secondary: #06b6d4;
            --accent: #f59e0b;
            --dark: #0f172a;
            --darker: #020617;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--darker);
            color: white;
        }

        .neon-box {
            box-shadow: 0 0 10px rgba(110, 40, 217, 0.5),
                       inset 0 0 5px rgba(110, 40, 217, 0.3);
        }

        .neon-button {
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(110, 40, 217, 0.5);
        }

        .neon-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(110, 40, 217, 0.8);
        }

        .form-input {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(109, 40, 217, 0.5);
        }

        .form-input:focus {
            border-color: rgba(109, 40, 217, 0.8);
            box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.3);
        }

        .tab-active {
            border-bottom: 2px solid var(--primary);
            color: white;
            font-weight: bold;
        }

        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-gray-900 rounded-xl p-8 neon-box">
        <!-- Логотип -->
        <div class="flex justify-center mb-8">
            <div class="flex items-center space-x-2">
                <div class="text-4xl text-yellow-400">
                    <i class="fas fa-dragon"></i>
                </div>
                <h1 class="font-bold text-2xl bg-gradient-to-r from-purple-500 via-pink-500 to-yellow-500 bg-clip-text text-transparent">
                    ЯжНаДэп
                </h1>
            </div>
        </div>

        <!-- Табы регистрации/входа -->
        <div class="flex border-b border-gray-700 mb-6">
            <button id="loginTab" class="flex-1 py-2 text-center tab-active">Вход</button>
            <button id="registerTab" class="flex-1 py-2 text-center text-gray-400">Регистрация</button>
        </div>

        <!-- Форма входа -->
        <form id="loginForm" class="space-y-4">
            <div>
                <label for="loginEmail" class="block text-sm font-medium mb-1">Email</label>
                <input type="email" id="loginEmail" required
                       class="w-full px-4 py-2 rounded-lg form-input focus:outline-none">
            </div>

            <div>
                <label for="loginPassword" class="block text-sm font-medium mb-1">Пароль</label>
                <input type="password" id="loginPassword" required
                       class="w-full px-4 py-2 rounded-lg form-input focus:outline-none">
            </div>

            <div id="loginError" class="error-message"></div>

            <button type="submit"
                    class="w-full py-2 px-4 rounded-full bg-gradient-to-r from-purple-600 to-blue-500 text-white font-semibold neon-button">
                Войти
            </button>
        </form>

        <!-- Форма регистрации -->
        <form id="registerForm" class="space-y-4 hidden">
            <div>
                <label for="registerUsername" class="block text-sm font-medium mb-1">Имя пользователя</label>
                <input type="text" id="registerUsername" required
                       class="w-full px-4 py-2 rounded-lg form-input focus:outline-none">
            </div>

            <div>
                <label for="registerEmail" class="block text-sm font-medium mb-1">Email</label>
                <input type="email" id="registerEmail" required
                       class="w-full px-4 py-2 rounded-lg form-input focus:outline-none">
            </div>

            <div>
                <label for="registerPassword" class="block text-sm font-medium mb-1">Пароль</label>
                <input type="password" id="registerPassword" required minlength="6"
                       class="w-full px-4 py-2 rounded-lg form-input focus:outline-none">
            </div>

            <div>
                <label for="registerConfirmPassword" class="block text-sm font-medium mb-1">Подтвердите пароль</label>
                <input type="password" id="registerConfirmPassword" required
                       class="w-full px-4 py-2 rounded-lg form-input focus:outline-none">
            </div>

            <div id="registerError" class="error-message"></div>

            <button type="submit"
                    class="w-full py-2 px-4 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 text-gray-900 font-bold neon-button">
                Зарегистрироваться
            </button>
        </form>

        <!-- Сообщение об успешной регистрации -->
        <div id="successMessage" class="hidden mt-4 p-4 bg-green-900/50 rounded-lg text-center">
            <p>Регистрация прошла успешно! Вы будете перенаправлены...</p>
        </div>
    </div>

    <script>
        // Инициализация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCDBRYFbAZzsc5K95dJQeRVSlyUeS0x2yg",
            authDomain: "kazinaks.firebaseapp.com",
            databaseURL: "https://kazinaks-default-rtdb.firebaseio.com",
            projectId: "kazinaks",
            storageBucket: "kazinaks.firebasestorage.app",
            messagingSenderId: "923668859204",
            appId: "1:923668859204:web:3696ac595e106b6f226f11",
            measurementId: "G-7CYFK7BGL0"
        };

        // Инициализируем Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Переключение между вкладками
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');

        loginTab.addEventListener('click', () => {
            loginTab.classList.add('tab-active');
            loginTab.classList.remove('text-gray-400');
            registerTab.classList.remove('tab-active');
            registerTab.classList.add('text-gray-400');
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
        });

        registerTab.addEventListener('click', () => {
            registerTab.classList.add('tab-active');
            registerTab.classList.remove('text-gray-400');
            loginTab.classList.remove('tab-active');
            loginTab.classList.add('text-gray-400');
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
        });

        // Обработка формы входа
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('loginError');

            errorElement.textContent = '';

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Успешный вход
                    window.location.href = 'index.html'; // Перенаправляем на главную
                })
                .catch((error) => {
                    // Обработка ошибок
                    let errorMessage;
                    switch(error.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'Некорректный email';
                            break;
                        case 'auth/user-disabled':
                            errorMessage = 'Пользователь заблокирован';
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'Пользователь не найден';
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Неверный пароль';
                            break;
                        default:
                            errorMessage = 'Ошибка входа. Попробуйте позже.';
                    }
                    errorElement.textContent = errorMessage;
                });
        });

        // Обработка формы регистрации
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const errorElement = document.getElementById('registerError');

            errorElement.textContent = '';

            // Валидация паролей
            if (password !== confirmPassword) {
                errorElement.textContent = 'Пароли не совпадают';
                return;
            }

            if (password.length < 6) {
                errorElement.textContent = 'Пароль должен содержать минимум 6 символов';
                return;
            }

            // Регистрация пользователя
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Успешная регистрация
                    const user = userCredential.user;

                    // Сохраняем дополнительную информацию о пользователе
                    return database.ref('users/' + user.uid).set({
                        username: username,
                        email: email,
                        balance: 1000, // Начальный баланс
                        registrationDate: firebase.database.ServerValue.TIMESTAMP
                    });
                })
                .then(() => {
                    // Показываем сообщение об успехе
                    document.getElementById('successMessage').classList.remove('hidden');
                    registerForm.classList.add('hidden');

                    // Перенаправляем через 2 секунды
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                })
                .catch((error) => {
                    // Обработка ошибок
                    let errorMessage;
                    switch(error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage = 'Email уже используется';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'Некорректный email';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'Пароль слишком простой';
                            break;
                        default:
                            errorMessage = 'Ошибка регистрации. Попробуйте позже.';
                    }
                    errorElement.textContent = errorMessage;
                });
        });

        // Проверяем, авторизован ли пользователь
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Если пользователь уже авторизован, перенаправляем на главную
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>
